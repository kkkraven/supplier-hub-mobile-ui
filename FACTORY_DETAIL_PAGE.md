# Детальная страница фабрики

## Обзор

Реализована полнофункциональная детальная страница фабрики с галереей фотографий, контактной информацией и интерактивной картой.

## Структура файлов

### 1. Страница маршрута (`/src/app/factories/[id]/page.tsx`)
- Динамическая страница Next.js для маршрута `/factories/[id]`
- Передает ID фабрики в компонент FactoryDetailPage

### 2. Основной компонент (`/src/components/pages/factory-detail-page.tsx`)
- Полнофункциональная детальная страница фабрики
- Интеграция с хуком useFactory для получения данных
- Адаптивный дизайн с мобильной оптимизацией

### 3. Компоненты UI

#### FactoryGallery (`/src/components/ui/factory-gallery.tsx`)
- Галерея фотографий с модальным окном
- Навигация по фотографиям (стрелки, клавиатура)
- Адаптивная сетка изображений
- Hover эффекты и анимации

#### FactoryMap (`/src/components/ui/factory-map.tsx`)
- Компонент для отображения карты
- Поддержка OpenStreetMap (бесплатно)
- Поддержка Google Maps (требует API ключ)
- Fallback для случаев без координат

## Функциональность

### 2.2.1 Создать страницу /factories/[id]
✅ **Реализовано:**
- Динамический маршрут `/factories/[id]`
- Получение данных фабрики по ID через хук useFactory
- Обработка состояний загрузки и ошибок
- Навигация назад к списку фабрик

### 2.2.2 Добавить галерею фотографий
✅ **Реализовано:**
- Сетка фотографий с адаптивным дизайном
- Модальное окно для просмотра в полном размере
- Навигация по фотографиям (стрелки, клавиатура)
- Hover эффекты и анимации
- Счетчик фотографий
- Поддержка клавиатурной навигации (Escape, стрелки)

### 2.2.3 Показать контактную информацию
✅ **Реализовано:**
- Полная контактная информация:
  - Телефон
  - Email (если доступен)
  - WeChat ID
  - Полный адрес
- Кнопки для начала чата и отправки RFQ
- Иконки для каждого типа контакта
- Дополнительная информация:
  - Дата верификации
  - Дата добавления в базу
  - Последнее взаимодействие

### 2.2.4 Добавить карту с местоположением
✅ **Реализовано:**
- Интерактивная карта с использованием OpenStreetMap
- Поддержка Google Maps (опционально)
- Отображение координат фабрики
- Fallback для случаев без координат
- Адаптивный дизайн карты

## Структура страницы

### Header секция
- Кнопка "Назад к списку"
- Название фабрики (английское и китайское)
- Бейджи: Verified, Segment, Interaction Level
- Рейтинг и количество отзывов
- Кнопки действий (Чат, RFQ)

### Основной контент (2 колонки)

#### Левая колонка (2/3 ширины)
1. **Галерея фотографий**
   - Сетка 2x3 на мобильных, 3x4 на десктопе
   - Модальное окно для просмотра

2. **Информационные вкладки**
   - **Обзор**: Описание фабрики и специализация
   - **Производство**: MOQ, сроки, мощность
   - **Сертификации**: Список сертификатов

#### Правая колонка (1/3 ширины)
1. **Контактная информация**
   - Все контакты с иконками
   - Кнопка "Начать чат"

2. **Карта местоположения**
   - Интерактивная карта
   - Адрес фабрики

3. **Дополнительная информация**
   - Даты верификации и добавления
   - История взаимодействий

## Технические особенности

### Состояния загрузки
- Спиннер загрузки с текстом
- Обработка ошибок с кнопкой возврата
- Пустые состояния для отсутствующих данных

### Адаптивность
- Мобильная оптимизация
- Адаптивная сетка галереи
- Responsive карта

### Производительность
- Ленивая загрузка изображений
- Оптимизированные запросы к Supabase
- Кэширование данных фабрики

### Доступность
- Поддержка клавиатурной навигации
- Alt-тексты для изображений
- Семантическая разметка

## Использование

### Базовое использование
```typescript
import { FactoryDetailPage } from '../components/pages/factory-detail-page';

export default function FactoryDetail({ params }: { params: { id: string } }) {
  return <FactoryDetailPage factoryId={params.id} />;
}
```

### Компоненты галереи и карты
```typescript
import { FactoryGallery } from '../components/ui/factory-gallery';
import { FactoryMap } from '../components/ui/factory-map';

// Галерея
<FactoryGallery 
  images={factoryImages} 
  title="Фотографии фабрики" 
/>

// Карта
<FactoryMap
  lat={factory.lat_lng?.lat}
  lng={factory.lat_lng?.lng}
  city={factory.city}
  province={factory.province}
/>
```

## Интеграция с Supabase

### Хук useFactory
- Автоматическая загрузка данных фабрики
- Обработка ошибок и состояний загрузки
- Кэширование результатов

### Структура данных
```typescript
interface Factory {
  factory_id: string;
  legal_name_cn: string;
  legal_name_en?: string;
  city: string;
  province?: string;
  lat_lng?: { lat: number; lng: number; };
  phone: string;
  email?: string;
  wechat_id: string;
  address_cn: string;
  // ... остальные поля
}
```

## Навигация

### Из списка фабрик
- Клик по карточке фабрики → переход на `/factories/[id]`
- Обновлена функция handleFactoryClick в FactoryListPage

### Обратная навигация
- Кнопка "Назад к списку" → возврат на `/factories`
- Использует Next.js router для навигации

## Следующие шаги

1. **Реальные фотографии** - интеграция с Supabase Storage для загрузки фотографий
2. **Google Maps API** - настройка API ключа для Google Maps
3. **Чат система** - реализация чата с фабриками
4. **RFQ форма** - создание формы запроса предложений
5. **Отзывы и рейтинги** - система отзывов о фабриках
6. **Похожие фабрики** - рекомендации похожих производителей
